<Window
    x:Class="Plexity.NewFlagFinderWindow"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:ui="http://schemas.lepo.co/wpfui/2022/xaml"
    Title="Flag Finder"
    Width="1200"
    Height="800"
    WindowStartupLocation="CenterScreen"
    Background="{DynamicResource ApplicationBackgroundBrush}"
    Foreground="{DynamicResource TextFillColorPrimaryBrush}"
    ui:Design.Background="{DynamicResource ApplicationBackgroundBrush}"
    ui:Design.Foreground="{DynamicResource TextFillColorPrimaryBrush}">

    <Grid Margin="15">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto" />
            <RowDefinition Height="Auto" />
            <RowDefinition Height="*" />
            <RowDefinition Height="Auto" />
        </Grid.RowDefinitions>

        <!-- Header and Refresh Controls -->
        <StackPanel Grid.Row="0" Orientation="Horizontal" Margin="0,0,0,15" VerticalAlignment="Center" >
            <TextBlock
                Text="Flag Finder"
                FontSize="18"
                FontWeight="SemiBold"
                VerticalAlignment="Center"
                Foreground="{DynamicResource TextFillColorPrimaryBrush}" />

            <ui:Button
                x:Name="RefreshButton"
                Content="Refresh All Sources"
                Appearance="Primary"
                Padding="15,5"
                Margin="20,0,0,0"
                Click="RefreshButton_Click" />

            <TextBlock
                x:Name="LoadingIndicator"
                Text="Loading..."
                Foreground="Orange"
                Visibility="Collapsed"
                VerticalAlignment="Center"
                Margin="15,0,0,0" />
        </StackPanel>

        <!-- Main Content Tabs -->
        <TabControl Grid.Row="1" Grid.RowSpan="2" Margin="0,0,0,10"
                    Background="{DynamicResource ApplicationBackgroundBrush}"
                    Foreground="{DynamicResource TextFillColorPrimaryBrush}">

            <!-- Flag Validation Tab -->
            <TabItem Header="🔍 Flag Validation" Padding="10,5">
                <Grid Margin="10">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto" />
                        <RowDefinition Height="200" />
                        <RowDefinition Height="Auto" />
                        <RowDefinition Height="*" />
                    </Grid.RowDefinitions>

                    <!-- Input Controls -->
                    <StackPanel Grid.Row="0" Orientation="Horizontal" Margin="0,0,0,10" VerticalAlignment="Center" >
                        <TextBlock
                            Text="Paste flags or import file:"
                            VerticalAlignment="Center"
                            Foreground="{DynamicResource TextFillColorPrimaryBrush}"
                            Margin="0,0,10,0" />

                        <ui:Button
                            x:Name="ImportFileButton"
                            Content="Import File"
                            Padding="8,4"
                            Click="ImportFileButton_Click" />

                        <ui:Button
                            x:Name="ValidateButton"
                            Content="Validate"
                            Padding="8,4"
                            Margin="10,0,0,0"
                            Click="ValidateButton_Click" />

                        <ui:Button
                            x:Name="RemoveInvalidButton"
                            Content="🗑️ Remove Invalid"
                            Appearance="Danger"
                            Padding="8,4"
                            Margin="10,0,0,0"
                            Click="RemoveInvalidButton_Click" />
                    </StackPanel>

                    <!-- Text Input Area -->
                    <ui:TextBox
                        x:Name="ValidationInput"
                        Grid.Row="1"
                        AcceptsReturn="True"
                        TextWrapping="Wrap"
                        VerticalScrollBarVisibility="Auto"
                        FontFamily="Consolas"
                        Padding="5"
                        KeyDown="ValidationInput_KeyDown"
                        PlaceholderText="Example:
{
  &quot;FFlagExampleFlag&quot;: true,
  &quot;DFIntExampleNumber&quot;: 123
}

Or line by line:
FFlagExampleFlag=true
DFIntExampleNumber=123" />

                    <!-- Validation Results Header -->
                    <TextBlock
                        Grid.Row="2"
                        Text="Validation Results:"
                        FontWeight="SemiBold"
                        Foreground="{DynamicResource TextFillColorPrimaryBrush}"
                        Margin="0,15,0,5" />

                    <!-- Validation Results Output -->
                    <ScrollViewer Grid.Row="3" VerticalScrollBarVisibility="Auto">
                        <TextBlock
                            x:Name="ValidationResults"
                            FontFamily="Consolas"
                            Foreground="{DynamicResource TextFillColorSecondaryBrush}"
                            Text="Results will appear here after validation."
                            TextWrapping="Wrap" />
                    </ScrollViewer>
                </Grid>
            </TabItem>

            <!-- Recent Flags Tab -->
            <TabItem Header="🕒 Recent Flags (24h)" Padding="10,5">
                <Grid Margin="10">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto" />
                        <RowDefinition Height="*" />
                        <RowDefinition Height="Auto" />
                    </Grid.RowDefinitions>

                    <!-- Filter Buttons -->
                    <StackPanel Grid.Row="0" Orientation="Horizontal" Margin="0,0,0,15">
                        <ui:Button
                            x:Name="ShowLast24HoursButton"
                            Content="All New Flags"
                            Padding="15,5"
                            Margin="0,0,10,0"
                            Click="ShowLast24HoursButton_Click" />
                        <ui:Button
                            x:Name="ShowTrueFlagsButton"
                            Content="True Flags Only"
                            Padding="10,5"
                            Margin="0,0,10,0"
                            Click="ShowTrueFlagsButton_Click" />
                        <ui:Button
                            x:Name="ShowFalseFlagsButton"
                            Content="False Flags Only"
                            Padding="10,5"
                            Click="ShowFalseFlagsButton_Click" />
                    </StackPanel>

                    <!-- Flags Data Grid -->
                    <DataGrid
                        x:Name="FlagDataGrid"
                        Grid.Row="1"
                        AutoGenerateColumns="False"
                        CanUserAddRows="False"
                        HeadersVisibility="Column"
                        IsReadOnly="True"
                        Margin="0,0,0,15">
                        <DataGrid.Columns>
                            <DataGridTextColumn Header="Flag Name" Binding="{Binding Name}" Width="*" />
                            <DataGridTextColumn Header="Value" Binding="{Binding Value}" Width="Auto" />
                            <DataGridTextColumn Header="Source" Binding="{Binding Source}" Width="Auto" />
                            <DataGridTextColumn Header="Timestamp" Binding="{Binding TimestampDisplay}" Width="Auto" />
                        </DataGrid.Columns>
                    </DataGrid>

                    <!-- Download Buttons -->
                    <StackPanel Grid.Row="2" Orientation="Horizontal" >
                        <ui:Button
                            x:Name="DownloadAllButton"
                            Content="Download All"
                            Padding="8,4"
                            Margin="0,0,10,0"
                            Click="DownloadAllButton_Click" />
                        <ui:Button
                            x:Name="DownloadTrueButton"
                            Content="Download True"
                            Padding="8,4"
                            Margin="0,0,10,0"
                            Click="DownloadTrueButton_Click" />
                        <ui:Button
                            x:Name="DownloadFalseButton"
                            Content="Download False"
                            Padding="8,4"
                            Click="DownloadFalseButton_Click" />
                    </StackPanel>
                </Grid>
            </TabItem>

            <!-- Live Search Tab -->
            <TabItem Header="🔎 Live Search" Padding="10,5">
                <Grid Margin="10">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto" />
                        <RowDefinition Height="*" />
                        <RowDefinition Height="Auto" />
                    </Grid.RowDefinitions>

                    <!-- Search Input -->
                    <StackPanel Grid.Row="0" Orientation="Horizontal" Margin="0,0,0,15" VerticalAlignment="Center">
                        <TextBlock
                            Text="Search for flags:"
                            Foreground="{DynamicResource TextFillColorPrimaryBrush}"
                            VerticalAlignment="Center"
                            Margin="0,0,10,0" />
                        <ui:TextBox
                            x:Name="SearchInput"
                            Width="300"
                            Padding="5"
                            KeyDown="SearchInput_KeyDown"
                            PlaceholderText="Search partial flag names (e.g., 'MoveStore', 'Optimization')" />
                        <ui:Button
                            x:Name="SearchButton"
                            Content="🔎 Search"
                            Appearance="Secondary"
                            Padding="8,4"
                            Margin="10,0,0,0"
                            Click="SearchButton_Click" />
                    </StackPanel>

                    <!-- Search Results -->
                    <ScrollViewer Grid.Row="1" VerticalScrollBarVisibility="Auto" Margin="0,0,0,15">
                        <ui:TextBox
                            x:Name="SearchResults"
                            MinHeight="300"
                            AcceptsReturn="True"
                            FontFamily="Consolas"
                            IsReadOnly="True"
                            TextWrapping="Wrap"
                            VerticalScrollBarVisibility="Auto"
                            Text="Enter a search term and click Search." />
                    </ScrollViewer>

                    <!-- Search Tip -->
                    <TextBlock
                        Grid.Row="2"
                        FontStyle="Italic"
                        Foreground="{DynamicResource TextFillColorSecondaryBrush}"
                        Text="💡 Tip: If results are too large to display, use the download options above." />
                </Grid>
            </TabItem>
        </TabControl>

        <!-- Status Bar -->
        <Border
            Grid.Row="3"
            Padding="10,5"
            Background="{DynamicResource ApplicationBackgroundBrush}"
            BorderBrush="{DynamicResource ControlStrokeColorDefaultBrush}"
            BorderThickness="0,1,0,0">
            <TextBlock
                x:Name="StatusText"
                Foreground="{DynamicResource TextFillColorPrimaryBrush}"
                Text="Ready. Click Refresh to fetch latest flags from all sources." />
        </Border>
    </Grid>
</Window>
