<Page
    x:Class="Plexity.Views.Pages.FastFlagEditor"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:local="clr-namespace:Plexity.Views.Pages"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:ui="http://schemas.lepo.co/wpfui/2022/xaml"
    Title="FastFlagEditor"
    d:DataContext="{d:DesignInstance local:FastFlagEditor, IsDesignTimeCreatable=False}"
    d:DesignHeight="750"
    d:DesignWidth="800"
    ui:Design.Background="{DynamicResource ApplicationBackgroundBrush}"
    ui:Design.Foreground="{DynamicResource TextFillColorPrimaryBrush}"
    Foreground="{DynamicResource TextFillColorPrimaryBrush}"
    Loaded="Page_Loaded"
    ScrollViewer.CanContentScroll="False"
    mc:Ignorable="d">

    <Grid Margin="0">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- Description -->
        <StackPanel Grid.Row="0" Margin="0,0,0,0">
            <TextBlock 
                Text="Manage your FastFlags. Double click a column to edit."
                FontSize="14"
                Margin="0,0,0,0"
                TextWrapping="Wrap" />
            <ui:InfoBar Padding="8" Title="Use with caution." IsOpen="True" Message="Misusing this can lead to instability or unexpected things happening." Severity="Warning" IsClosable="False" Height="45" Margin="0,20,0,0" />
        </StackPanel>

        <!-- Search & Count -->
        <DockPanel Grid.Row="1" Height="40" LastChildFill="True" Margin="0,0,0,10">
            <ui:TextBox x:Name="SearchTextBox"
                        Width="650"
                        Height="32"
                        Margin="0,5,10,0"
                        Icon="Search48"
                        PlaceholderText="Search"
                        FontSize="14"
                        VerticalContentAlignment="Center"
                        BorderThickness="0"
                        TextChanged="SearchTextBox_TextChanged" />
            <TextBlock x:Name="TotalFlagsTextBlock"
                       VerticalAlignment="Center"
                       FontSize="14"
                       Foreground="#FFCACACA"
                       Text="Flags added: 0"
                       Margin="0,16,10,0" />
        </DockPanel>

        <!-- DataGrid -->
        <DataGrid Grid.Row="2"
                  Name="DataGrid"
                  Margin="0,0,0,20"
                  AutoGenerateColumns="False"
                  HeadersVisibility="Column"
                  CanUserAddRows="False"
                  CanUserDeleteRows="False"
                  CanUserReorderColumns="True"
                  GridLinesVisibility="None"
                  RowHeight="25"
                  CellEditEnding="DataGrid_CellEditEnding"
                  Background="Transparent"
                  FontSize="14"
                  Foreground="White"
                  RowBackground="#232323"
                  AlternatingRowBackground="#232323"
                  HorizontalGridLinesBrush="#232323"
                  VerticalGridLinesBrush="#232323"
                  SelectionMode="Single"
                  SelectionUnit="FullRow"
                  ScrollViewer.VerticalScrollBarVisibility="Auto"
                  MinHeight="100"
                  VerticalAlignment="Stretch"
                  HorizontalAlignment="Stretch">

            <!-- Header Style -->
            <DataGrid.ColumnHeaderStyle>
                <Style TargetType="DataGridColumnHeader">
                    <Setter Property="Background" Value="#2C2C2C"/>
                    <Setter Property="Foreground" Value="White"/>
                    <Setter Property="Padding" Value="10,0"/>
                    <Setter Property="Height" Value="32"/>
                    <Setter Property="BorderThickness" Value="0,0,0,1"/>
                    <Setter Property="BorderBrush" Value="#444"/>
                </Style>
            </DataGrid.ColumnHeaderStyle>

            <!-- Cell Style -->
            <DataGrid.CellStyle>
                <Style TargetType="DataGridCell">
                    <Setter Property="Padding" Value="5,0"/>
                    <Setter Property="Foreground" Value="White"/>
                    <Setter Property="Background" Value="Transparent"/>
                    <Setter Property="BorderThickness" Value="0"/>
                    <Setter Property="VerticalContentAlignment" Value="Center"/>
                    <Style.Triggers>
                        <Trigger Property="IsSelected" Value="True">
                            <Setter Property="Background" Value="#3A3A3A"/>
                            <Setter Property="Foreground" Value="White"/>
                        </Trigger>
                    </Style.Triggers>
                </Style>
            </DataGrid.CellStyle>

            <!-- Columns -->
            <DataGrid.Columns>
                <DataGridTextColumn Header="Name" Binding="{Binding Name, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" Width="*" />
                <DataGridTextColumn Header="Value" Binding="{Binding Value, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" Width="2*" />
            </DataGrid.Columns>
        </DataGrid>

        <!-- Buttons -->
        <WrapPanel Grid.Row="3" HorizontalAlignment="Left" Margin="0,10,0,0" ItemHeight="40" ItemWidth="Auto" Orientation="Horizontal" VerticalAlignment="Center" >
            <ui:Button Width="100" Margin="0,0,10,10" Content="Add New" Icon="AddCircle24" Foreground="{DynamicResource TextFillColorPrimaryBrush}" Click="AddButton_Click"/>
            <ui:Button Width="120" Margin="0,0,10,10" Content="Delete Selected" Icon="SlideEraser24" Click="DeleteButton_Click"
                       Appearance="Danger"
                       Background="#ff3334" Foreground="{DynamicResource TextFillColorPrimaryBrush}">
                <ui:Button.PressedBackground>
                    <SolidColorBrush Opacity="0.7" Color="#ff5c5d" />
                </ui:Button.PressedBackground>
                <ui:Button.MouseOverBackground>
                    <SolidColorBrush Opacity="0.9" Color="#ff5c5d" />
                </ui:Button.MouseOverBackground>
                <ui:Button.Style>
                    <Style BasedOn="{StaticResource {x:Type ui:Button}}" TargetType="{x:Type ui:Button}">
                        <Style.Triggers>
                            <DataTrigger Binding="{Binding SelectedItems.Count, ElementName=DataGrid}" Value="0">
                                <Setter Property="IsEnabled" Value="False" />
                            </DataTrigger>
                        </Style.Triggers>
                    </Style>
                </ui:Button.Style>
            </ui:Button>
            <ui:Button Width="100" Margin="0,0,10,10" Foreground="{DynamicResource TextFillColorPrimaryBrush}" Content="Delete All" Icon="Delete48" Click="DeleteAllButton_Click"/>
            <ui:Button Width="100" Margin="0,0,10,10" Foreground="{DynamicResource TextFillColorPrimaryBrush}" Content="Copy All" Icon="Clipboard16" Click="CopyJSONButton_Click1"/>
            <ui:Button Width="150" Margin="0,0,10,10" Foreground="{DynamicResource TextFillColorPrimaryBrush}" Content="Copy JSON (Better)" Icon="Copy16" Click="CopyJSONButton_Click2"/>
            <ui:Button Width="100" Margin="0,0,10,10" Foreground="{DynamicResource TextFillColorPrimaryBrush}" Content="Export" Icon="ArrowExit20" Click="ExportJSONButton_Click"/>
        </WrapPanel>
    </Grid>
</Page>
