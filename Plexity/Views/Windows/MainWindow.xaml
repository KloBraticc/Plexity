<ui:FluentWindow
    x:Class="Plexity.Views.Windows.MainWindow"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:local="clr-namespace:Plexity.Views.Windows"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:ui="http://schemas.lepo.co/wpfui/2022/xaml"
    Title="{Binding ViewModel.ApplicationTitle}"
    WindowStartupLocation="CenterScreen"
    ExtendsContentIntoTitleBar="True"
    WindowBackdropType="Mica"
    WindowCornerPreference="RoundSmall"
    Background="{ui:ThemeResource ApplicationBackgroundBrush}"
    Foreground="{DynamicResource TextFillColorPrimaryBrush}"
    ui:Design.Background="{DynamicResource ApplicationBackgroundBrush}"
    ui:Design.Foreground="{DynamicResource TextFillColorPrimaryBrush}"
    mc:Ignorable="d"
    d:DataContext="{d:DesignInstance local:MainWindow, IsDesignTimeCreatable=True}"
    d:Width="1360"
    d:Height="780"
    MinWidth="1360"
    MinHeight="780">

    <Grid>
        <!-- Grid Layout -->
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <!-- Title Bar -->
            <RowDefinition Height="*"/>
            <!-- Main Content -->
            <RowDefinition Height="Auto"/>
            <!-- Status Bar -->
        </Grid.RowDefinitions>

        <!-- Title Bar -->
        <ui:TitleBar
            x:Name="TitleBar"
            Grid.Row="0"
            Title="{Binding ViewModel.ApplicationTitle}"
            Padding="7"
            ForceShutdown="False">
            <ui:TitleBar.Icon>
                <ui:ImageIcon 
                    Source="pack://application:,,,/Assets/wpfui-icon-256.png" 
                    Margin="0,-3,0,0"/>
            </ui:TitleBar.Icon>
        </ui:TitleBar>

        <!-- Navigation View -->
        <ui:NavigationView
            x:Name="RootNavigation"
            Grid.Row="1"
            Padding="20,0"
            FrameMargin="0"
            PaneDisplayMode="LeftFluent"
            MenuItemsSource="{Binding ViewModel.MenuItems}"
            FooterMenuItemsSource="{Binding ViewModel.FooterMenuItems}"
            BreadcrumbBar="{Binding ElementName=BreadcrumbBar}">

            <ui:NavigationView.Header>
                <ui:BreadcrumbBar 
                    x:Name="BreadcrumbBar" 
                    Margin="12,16,12,8"/>
            </ui:NavigationView.Header>

            <ui:NavigationView.ContentOverlay>
                <Grid>
                    <ui:SnackbarPresenter x:Name="SnackbarPresenter"/>
                </Grid>
            </ui:NavigationView.ContentOverlay>
        </ui:NavigationView>

        <!-- Overlay: Content Dialog -->
        <ContentPresenter 
            x:Name="RootContentDialog"
            Grid.Row="0"
            Grid.RowSpan="2"/>

        <!-- Overlay: Notification Panel -->
        <Grid
            x:Name="NotificationPanel"
            Visibility="Collapsed"
            HorizontalAlignment="Center"
            VerticalAlignment="Bottom"
            Opacity="0"
            RenderTransformOrigin="0.5,0.5"
            Panel.ZIndex="99">

            <Grid.RenderTransform>
                <ScaleTransform 
                    x:Name="NotificationScale" 
                    ScaleX="0.95" 
                    ScaleY="0.95"/>
            </Grid.RenderTransform>

            <Border
                Background="#FF2D2C2C"
                CornerRadius="3"
                Padding="14"
                Width="360"
                HorizontalAlignment="Center"
                Margin="0,8,0,-12">

                <Border.Effect>
                    <DropShadowEffect 
                        BlurRadius="12"
                        ShadowDepth="3"
                        Opacity="0.4"
                        Direction="270"
                        Color="Black"/>
                </Border.Effect>

                <StackPanel Orientation="Horizontal" VerticalAlignment="Center">
                    <TextBlock 
                        Text="✔"
                        Foreground="#90EE90"
                        FontSize="18"
                        FontWeight="Bold"
                        Margin="0,0,10,0"
                        VerticalAlignment="Center"/>

                    <TextBlock 
                        x:Name="NotificationText"
                        Text="Settings Saved!"
                        Foreground="{DynamicResource TextFillColorPrimaryBrush}"
                        FontSize="15"
                        FontWeight="SemiBold"
                        TextWrapping="Wrap"
                        VerticalAlignment="Center"/>
                </StackPanel>
            </Border>
        </Grid>

        <!-- Status Bar -->
        <StatusBar
            x:Name="RootStatusBar"
            Grid.Row="2"
            Padding="14,10"
            BorderThickness="0,1,0,0"
            Background="{x:Null}">

            <StatusBar.ItemsPanel>
                <ItemsPanelTemplate>
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="Auto"/>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="Auto"/>
                            <ColumnDefinition Width="Auto"/>
                            <ColumnDefinition Width="Auto"/>
                        </Grid.ColumnDefinitions>
                    </Grid>
                </ItemsPanelTemplate>
            </StatusBar.ItemsPanel>

            <!-- Save and Launch Button -->
            <StatusBarItem Grid.Column="2" Padding="0,0,8,0">
                <ui:Button
                    Width="130"
                    Content="Save And Launch"
                    Appearance="Primary"
                    Click="Button_Click"
                    Command="{Binding SaveAndLaunchSettingsCommand}"/>
            </StatusBarItem>

            <!-- Save Button -->
            <StatusBarItem Grid.Column="3" Padding="0,0,9,0">
                <ui:Button
                    Width="58"
                    Content="Save"
                    Appearance="Primary"
                    Click="Button_Click_1"
                    Command="{Binding SaveSettingsCommand}"/>
            </StatusBarItem>

            <!-- Close Button -->
            <StatusBarItem Grid.Column="4" Padding="0,0,8,0">
                <ui:Button
                    Width="58"
                    Content="Close"
                    Appearance="Secondary"
                    Click="Close_Click"
                    Command="{Binding CloseWindowCommand}"/>
            </StatusBarItem>
        </StatusBar>
    </Grid>
</ui:FluentWindow>
