<ui:FluentWindow
    x:Class="Plexity.Views.Windows.MainWindow"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:local="clr-namespace:Plexity.Views.Windows"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:ui="http://schemas.lepo.co/wpfui/2022/xaml"
    Title="{Binding ViewModel.ApplicationTitle, Mode=OneWay}"
    MinWidth="1360"
    MinHeight="780"
    d:DataContext="{d:DesignInstance local:MainWindow,
                                     IsDesignTimeCreatable=True}"
    d:Height="780"
    d:Width="1360"
    ui:Design.Background="{DynamicResource BackgroundPrimaryBrush}"
    ui:Design.Foreground="{DynamicResource TextPrimaryBrush}"
    Background="{DynamicResource BackgroundPrimaryBrush}"
    ExtendsContentIntoTitleBar="True"
    Foreground="{DynamicResource TextPrimaryBrush}"
    SnapsToDevicePixels="True"
    UseLayoutRounding="True"
    WindowBackdropType="Mica"
    WindowCornerPreference="RoundSmall"
    WindowStartupLocation="CenterScreen"
    mc:Ignorable="d">

    <ui:FluentWindow.Resources>
        <ResourceDictionary>
            <ResourceDictionary.MergedDictionaries>
                <ResourceDictionary Source="/Resources/Styles/ModernStyles.xaml" />
                <ResourceDictionary Source="/Resources/Styles/HighContrastColors.xaml" />
            </ResourceDictionary.MergedDictionaries>
        </ResourceDictionary>
    </ui:FluentWindow.Resources>

    <Grid UseLayoutRounding="True">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto" />
            <!--  TitleBar  -->
            <RowDefinition Height="*" />
            <!--  Navigation  -->
            <RowDefinition Height="Auto" />
            <!--  StatusBar  -->
        </Grid.RowDefinitions>

        <!--  Title Bar  -->
        <ui:TitleBar
            x:Name="TitleBar"
            Title="{Binding ViewModel.ApplicationTitle}"
            Grid.Row="0"
            Padding="8"
            Background="{DynamicResource BackgroundSecondaryBrush}"
            ForceShutdown="False">
            <ui:TitleBar.Icon>
                <ui:ImageIcon Margin="0,-3,0,0" Source="pack://application:,,,/Assets/wpfui-icon-256.png" />
            </ui:TitleBar.Icon>
        </ui:TitleBar>

        <ui:NavigationView
            x:Name="RootNavigation"
            Grid.Row="1"
            Padding="{DynamicResource NavigationViewContentMargin}"
            Background="{DynamicResource BackgroundPrimaryBrush}"
            BreadcrumbBar="{Binding ElementName=BreadcrumbBar}"
            FooterMenuItemsSource="{Binding ViewModel.FooterMenuItems, Mode=OneWay}"
            FrameMargin="0"
            MenuItemsSource="{Binding ViewModel.MenuItems, Mode=OneWay}"
            PaneDisplayMode="LeftFluent">

            <ui:NavigationView.Header>
                <ui:BreadcrumbBar
                    x:Name="BreadcrumbBar"
                    Margin="12,16,12,8"
                    Foreground="{DynamicResource TextSecondaryBrush}" />
            </ui:NavigationView.Header>

            <ui:NavigationView.ContentOverlay>
                <Grid>
                    <ui:SnackbarPresenter x:Name="SnackbarPresenter" />
                </Grid>
            </ui:NavigationView.ContentOverlay>
        </ui:NavigationView>

        <!--  Content Dialog Overlay  -->
        <ContentPresenter
            x:Name="RootContentDialog"
            Grid.Row="0"
            Grid.RowSpan="2" />

        <!--  Improved Notification Panel  -->
        <Grid
            x:Name="NotificationPanel"
            Margin="0,0,0,60"
            HorizontalAlignment="Center"
            VerticalAlignment="Bottom"
            Panel.ZIndex="99"
            Opacity="0"
            RenderTransformOrigin="0.5,0.5"
            UseLayoutRounding="True"
            Visibility="Collapsed">

            <Grid.RenderTransform>
                <ScaleTransform x:Name="NotificationScale" ScaleX="0.95" ScaleY="0.95" />
            </Grid.RenderTransform>

            <Border
                Width="360"
                Margin="0,8,0,-12"
                Padding="16"
                HorizontalAlignment="Center"
                Background="{DynamicResource BackgroundSecondaryBrush}"
                BorderBrush="{DynamicResource PrimaryAccentBrush}"
                BorderThickness="1"
                CornerRadius="8"
                UseLayoutRounding="True">
                <Border.Effect>
                    <DropShadowEffect
                        BlurRadius="16"
                        Direction="270"
                        Opacity="0.3"
                        ShadowDepth="4"
                        Color="#DD88B5" />
                </Border.Effect>

                <StackPanel VerticalAlignment="Center" Orientation="Horizontal">
                    <TextBlock
                        Margin="0,0,12,0"
                        VerticalAlignment="Center"
                        FontSize="20"
                        FontWeight="Bold"
                        Foreground="{DynamicResource PrimaryAccentBrush}"
                        Text="✔" />
                    <TextBlock
                        x:Name="NotificationText"
                        VerticalAlignment="Center"
                        FontFamily="Segoe UI Variable Display"
                        FontSize="15"
                        FontWeight="SemiBold"
                        Foreground="{DynamicResource TextPrimaryBrush}"
                        Text="Settings Saved!"
                        TextWrapping="Wrap" />
                </StackPanel>
            </Border>
        </Grid>

        <!--  Fixed Status Bar with Better Button Layout  -->
        <Border
            x:Name="RootStatusBar"
            Grid.Row="2"
            Height="60"
            Background="{DynamicResource BackgroundSecondaryBrush}"
            BorderBrush="{DynamicResource BorderSecondaryBrush}"
            BorderThickness="0,1,0,0"
            UseLayoutRounding="True">
            <Grid Margin="20,10">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*" />
                    <ColumnDefinition Width="Auto" />
                </Grid.ColumnDefinitions>

                <!--  Status text area  -->
                <TextBlock
                    Grid.Column="0"
                    VerticalAlignment="Center"
                    FontSize="12"
                    Foreground="{DynamicResource TextSecondaryBrush}"
                    Text="Ready" />

                <!--  Right-aligned button container with proper spacing  -->
                <StackPanel
                    Grid.Column="1"
                    HorizontalAlignment="Right"
                    VerticalAlignment="Center"
                    Orientation="Horizontal">

                    <!--  Save And Launch Button  -->
                    <ui:Button
                        Width="140"
                        Height="34"
                        Margin="0,0,8,0"
                        Command="{Binding SaveAndLaunchSettingsCommand, Mode=OneWay}"
                        Content="Save And Launch"
                        FontWeight="SemiBold"
                        Style="{StaticResource PrimaryButtonStyle}" />

                    <!--  Save Button  -->
                    <ui:Button
                        Width="80"
                        Height="34"
                        Margin="0,0,8,0"
                        Command="{Binding SaveSettingsCommand, Mode=OneWay}"
                        Content="Save"
                        FontWeight="SemiBold"
                        Style="{StaticResource PrimaryButtonStyle}" />

                    <!--  Close Button  -->
                    <ui:Button
                        Width="80"
                        Height="34"
                        Command="{Binding CloseWindowCommand, Mode=OneTime}"
                        Content="Close"
                        FontWeight="SemiBold"
                        Style="{StaticResource SecondaryButtonStyle}" />

                </StackPanel>
            </Grid>
        </Border>
    </Grid>
</ui:FluentWindow>
